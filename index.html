<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TCSS 142 ¬∑ Project 2 Tester</title>

  <!--
    Fun behavior & easter eggs in this Project 2 tester (SurgeSimulator):

    1) Late-night hero message
       - In runTests(), the text under the main title switches based on time:
         ‚Ä¢ Between 11 PM and 6 AM:
           "Late night surge testing squad online. Tool by TA Faiz Ahmed."
         ‚Ä¢ Otherwise:
           "Instructor: Professor Xutong Liu ¬∑ Built and maintained by TA Faiz Ahmed"

    2) Confetti on full pass
       - If the tester output contains "All checks passed":
         ‚Ä¢ Status changes to "All checks passed (nice work)."
         ‚Ä¢ Confidence bar jumps to 100% with label "high".
         ‚Ä¢ Colored Husky-themed confetti falls across the screen.
         ‚Ä¢ A toast appears: "All checks passed. Go Dawgs, and props to your TA."

    3) Toast notifications
       - Small bottom-center toast bubble used for:
         ‚Ä¢ All tests passed (Go Dawgs message).
         ‚Ä¢ Compilation failures.
         ‚Ä¢ Timeouts.
         ‚Ä¢ Network errors.
       - Also used by secret title chip easter egg (see #7).

    4) Dynamic document title
       - The browser tab title changes depending on status:
         ‚Ä¢ While running: "‚è≥ Running tests ¬∑ TCSS 142"
         ‚Ä¢ All checks passed: "‚úÖ All checks passed ¬∑ TCSS 142"
         ‚Ä¢ On error: "‚ö†Ô∏è Check your code ¬∑ TCSS 142"
         ‚Ä¢ Otherwise: "TCSS 142 ¬∑ Project 2 Tester"

    5) Confidence meter
       - The glowing meter bar animates while tests are running.
       - After completion it reflects a rough "confidence" percentage:
         ‚Ä¢ Higher when all checks passed, lower on compile errors or empty input.
       - Hover text on the meter:
         "Rough confidence gauge, not an official score."

    6) Cheer messages based on outcome
       - Different pools of hints depending on result:
         ‚Ä¢ Good run (all checks passed): encouraging notes about surge logic.
         ‚Ä¢ Okay / partial: tips about edge cases, rounding, and off-by-one errors.
         ‚Ä¢ Error: reminders to check syntax, class name, and local compilation first.

    7) Secret TA credit on the title chip
       - Double-click the "SurgeTester ¬∑ Project 2" pill:
         ‚Ä¢ Shows toast: "TA dev credits unlocked. This tester was coded by Faiz Ahmed."
         ‚Ä¢ Changes footer hint text to: "You got this!"

    8) Code autosave
       - Editor contents are saved to localStorage under:
         "tcss142_p2_surgesim_code"
       - On reload, any previously pasted code is restored automatically.

    9) Keyboard shortcuts
       - Global shortcuts using Ctrl (Windows/Linux) or Cmd (macOS):
         ‚Ä¢ Ctrl/Cmd + Enter ‚Üí Run tests
         ‚Ä¢ Esc ‚Üí Clear editor and output
         ‚Ä¢ Shift + Esc ‚Üí Clear output only
         ‚Ä¢ Ctrl/Cmd + I ‚Üí Insert template
         ‚Ä¢ Ctrl/Cmd + L ‚Üí Clear editor and output
         ‚Ä¢ Ctrl/Cmd + S ‚Üí Save current code to localStorage
         ‚Ä¢ Ctrl/Cmd + O ‚Üí Load saved code from localStorage

    10) Husky purple blob cursor
        - A chain of blurred purple blobs follows the cursor around
          the screen using a trailing animation.
        - Uses an SVG filter ("husky-blob") to create a gooey glow.

    11) Background traffic layer
        - Semi-transparent emoji cars (üöóüöïüöôüöê) drive across the background
          at different lanes and speeds, behind the main UI.

    12) UW-styled background & watermark
        - Radial gradients in Husky purple/gold palette.
        - Subtle UW "W" watermark rotated in the corner.
        - Grid overlay that gives a studio-mockup feel behind the cards.

    13) Status chip
        - The small chip next to the Run button shows:
          ‚Ä¢ Text: Idle / Running / Completed / Compilation failed / etc.
          ‚Ä¢ Dot color: neutral, green (ok), yellow (warn), red (error),
            matching the current tester state.

    14) Template helper
        - "Insert template" button drops in a minimal SurgeSimulator skeleton,
          with a hint: "Fill in methods to match the project handout."

    Overall: this is an unofficial helper built and coded by TA Faiz Ahmed,
    meant to make strict auto-testing feel a little more like a polished app
    and a little less like a scary compiler wall of text.
  -->
  
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      /* UW palette based theme */
      --husky-purple:#32006e;
      --spirit-purple:#4b2e83;
      --husky-gold:#e8e3d3;
      --heritage-gold:#85754d;
      --accent-green:#aadb1e;
      --accent-teal:#2ad2c9;
      --accent-pink:#e93cac;
      --accent-lavender:#c5b4e3;

      --bg:#120428;
      --ink:#fdfdff;
      --muted:#c5c9e6;
      --panel:rgba(13,8,30,.92);
      --panel-border:rgba(232,227,211,.16);
      --accent:#b7a57a;
      --accent-2:#e8e3d3;
      --ok:#2bd67b;
      --warn:#ffcc4d;
      --err:#ff5d5d;
      --code-bg:#101528;
      --code-fg:#e6ebff;
      --radius:16px;
      --shadow:0 18px 48px rgba(0,0,0,.6);
      --loader-speed:1.3s;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 900px at 80% -20%, rgba(197,180,227,.35), transparent 60%),
        radial-gradient(900px 700px at -10% 30%, rgba(42,210,201,.20), transparent 60%),
        radial-gradient(1200px 900px at 50% 110%, rgba(183,165,122,.3), transparent 65%),
        radial-gradient(circle at top, var(--spirit-purple) 0%, var(--husky-purple) 55%, #060112 100%);
      overflow-x:hidden;
      min-height:100vh;
      position:relative;
      color-scheme:dark;
    }

    /* Decorative UW grid */
    .uw-grid-layer{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-3;
      background-image:
        linear-gradient(to right, rgba(232,227,211,.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(232,227,211,.04) 1px, transparent 1px);
      background-size:40px 40px;
      mix-blend-mode:soft-light;
      opacity:.75;
    }

    /* Subtle W watermark */
    .w-watermark{
      position:fixed;
      right:-28px;
      bottom:-80px;
      font-size:220px;
      font-weight:900;
      font-family:Georgia,"Times New Roman",serif;
      color:rgba(232,227,211,.045);
      letter-spacing:.1em;
      transform:rotate(-14deg);
      z-index:0;
      pointer-events:none;
    }

    /* App shell sits above the blob and traffic layers */
    .app-shell{
      position:relative;
      z-index:1;
    }

    .hero{
      text-align:center;
      padding:60px 20px 20px;
    }
    .title{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 16px;
      margin-bottom:10px;
      border-radius:999px;
      border:1px solid rgba(232,227,211,.4);
      font-size:12px;
      background:linear-gradient(
        135deg,
        rgba(75,46,131,.98),
        rgba(50,0,110,.96)
      );
      color:#ffffff;
      backdrop-filter:blur(8px);
      box-shadow:0 14px 38px rgba(0,0,0,.7);
      cursor:default;
    }
    .title-pill-dot{
      width:7px;
      height:7px;
      border-radius:50%;
      background:#aadb1e;
      box-shadow:0 0 10px rgba(170,219,30,.9);
    }
    .title-ta-tag{
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(232,227,211,.65);
      background:rgba(11,16,32,.85);
      font-size:11px;
      color:var(--husky-gold);
      letter-spacing:.03em;
      text-transform:uppercase;
    }
    h1{
      margin:14px 0 8px;
      font-size:clamp(28px,4vw,44px);
      letter-spacing:.02em;
    }
    .grad{
      background:linear-gradient(90deg,#ffffff,var(--husky-gold));
      -webkit-background-clip:text;
      color:transparent;
      font-weight:800;
    }
    .credit{
      color:var(--muted);
      font-size:13px;
    }

    .wrap{
      max-width:1100px;
      margin:auto;
      padding:20px;
      display:grid;
      gap:20px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--panel-border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter:blur(18px);
      overflow:hidden;
    }
    .section-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 18px 0;
    }
    .section-head b{ font-size:14px }
    .tbtn{
      padding:6px 10px;
      font-size:12px;
      border:1px solid var(--panel-border);
      border-radius:8px;
      background:rgba(232,227,211,.06);
      color:var(--ink);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .tbtn:hover{
      filter:brightness(1.09);
      box-shadow:0 6px 18px rgba(0,0,0,.4);
      transform:translateY(-1px);
    }

    .codebox{
      display:grid;
      grid-template-columns:auto 1fr;
      border-top:1px solid var(--panel-border);
      border-bottom:1px solid var(--panel-border);
    }
    .gutter{
      background:rgba(255,255,255,.03);
      border-right:1px solid var(--panel-border);
      padding:12px 8px;
      text-align:right;
      color:#c5c9e6;
      user-select:none;
      white-space:pre;
      overflow:hidden;
      font:12px/1.55 ui-monospace,monospace;
      min-width:42px;
    }
    textarea{
      width:100%;
      min-height:420px;
      resize:vertical;
      padding:12px 14px;
      background:#101528;
      color:var(--code-fg);
      border:0;
      outline:none;
      font:13.5px/1.55 ui-monospace,monospace;
      white-space:pre;
      overflow-wrap:normal;
    }

    .bar{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      padding:12px 14px;
    }
    .btn{
      border:0;
      border-radius:10px;
      padding:10px 16px;
      background:linear-gradient(90deg,var(--husky-gold),var(--accent));
      color:#20113f;
      font-weight:600;
      cursor:pointer;
      box-shadow:0 12px 28px rgba(0,0,0,.6);
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn.secondary{
      background:rgba(255,255,255,.08);
      color:var(--ink);
      border:1px solid var(--panel-border);
      box-shadow:none;
    }
    .btn:hover{
      filter:brightness(1.03);
      transform:translateY(-1px);
      box-shadow:0 16px 34px rgba(0,0,0,.65);
    }
    .btn:active{
      transform:translateY(0);
      box-shadow:0 8px 20px rgba(0,0,0,.5);
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      font-size:12px;
      border:1px solid var(--panel-border);
      border-radius:10px;
      background:rgba(255,255,255,.06);
    }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--muted) }
    .dot.ok{ background:var(--ok) }
    .dot.warn{ background:var(--warn) }
    .dot.err{ background:var(--err) }

    .meter{
      position:relative;
      flex:1;
      min-width:120px;
      height:6px;
      border-radius:999px;
      overflow:hidden;
      background:rgba(255,255,255,.08);
    }
    .meter .fill{
      position:absolute;
      inset:0;
      width:20%;
      opacity:.9;
      border-radius:999px;
      background:
        linear-gradient(90deg,
          rgba(255,255,255,.0) 0%,
          rgba(255,255,255,.25) 35%,
          rgba(255,255,255,.0) 70%),
        linear-gradient(90deg,var(--husky-gold),var(--accent));
      background-size:220% 100%, 100% 100%;
      background-position:-200% 0, 0 0;
      animation:shimmer var(--loader-speed) linear infinite;
      animation-play-state:paused;
      transform:translateX(-120%);
    }
    .meter.running .fill{
      animation-play-state:running;
      transform:translateX(0);
    }
    @keyframes shimmer{
      0%   { background-position:-200% 0, 0 0 }
      100% { background-position: 200% 0, 0 0 }
    }
    @media (prefers-reduced-motion: reduce){
      .meter .fill{
        animation:none;
        background:linear-gradient(90deg,var(--husky-gold),var(--accent));
        opacity:.7;
      }
      .meter.running .fill{ opacity:.95 }
    }

    .meta{
      font-size:12px;
      color:var(--muted);
    }

    .console{ padding:14px }
    .screen{
      background:#101528;
      color:var(--code-fg);
      border:1px solid rgba(255,255,255,.1);
      border-radius:10px;
      padding:14px;
      min-height:120px;
      font:13.5px/1.55 ui-monospace,monospace;
      white-space:pre-wrap;
    }

    footer{
      max-width:1100px;
      margin:40px auto;
      padding:0 20px;
      color:var(--muted);
      font-size:14px;
    }
    .foot-card{
      background:rgba(13,8,30,.92);
      border:1px solid var(--panel-border);
      border-radius:12px;
      padding:14px 16px;
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
    }
    a{
      color:var(--husky-gold);
      text-decoration:none;
    }
    a:hover{ text-decoration:underline }

    .kbd{
      font:12px/1;
      padding:4px 6px;
      border-radius:6px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--panel-border);
    }
    .shortcuts{
      display:grid;
      gap:6px;
      font-size:12px;
      margin-top:10px;
    }

    /* ---------- Husky Purple Blob Cursor Layer ---------- */

    .blob-layer{
      position:fixed;
      inset:0;
      pointer-events:none;
      filter:url(#husky-blob);
      z-index:0;
      overflow:hidden;
    }

    .blob-dot{
      position:absolute;
      top:0;
      left:0;
      border-radius:50%;
      background:radial-gradient(circle at 30% 20%, #c5b4e3 0, #6a33d9 40%, #32006e 100%);
      box-shadow:0 25px 55px rgba(0,0,0,0.85);
      opacity:0.9;
      transform:translate3d(-50%, -50%, 0);
      will-change:transform;
    }

    .blob-dot:nth-child(1){ width:55px;  height:55px; }
    .blob-dot:nth-child(2){ width:90px;  height:90px; }
    .blob-dot:nth-child(3){ width:120px; height:120px; }
    .blob-dot:nth-child(4){ width:140px; height:140px; }
    .blob-dot:nth-child(5){ width:100px; height:100px; }
    .blob-dot:nth-child(6){ width:70px;  height:70px; }

    /* ---------- Background traffic layer ---------- */

    .traffic-layer{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-1;
      opacity:.18;
    }
    .traffic-car{
      position:absolute;
      font-size:22px;
      animation:drive 16s linear infinite;
    }
    @keyframes drive{
      0%   { transform: translateX(-12vw); }
      100% { transform: translateX(112vw); }
    }

    /* ---------- Confetti + toast layer ---------- */

    #confetti-layer{
      pointer-events:none;
      position:fixed;
      inset:0;
      overflow:hidden;
      z-index:3;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:24px;
      transform:translateX(-50%) translateY(120%);
      background:var(--spirit-purple);
      color:#ffffff;
      border-radius:999px;
      padding:10px 18px;
      border:1px solid var(--husky-gold);
      box-shadow:0 16px 40px rgba(0,0,0,.6);
      font-size:13px;
      opacity:0;
      transition:opacity .25s ease-out, transform .25s ease-out;
      z-index:4;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(0);
    }
    .toast-dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background:var(--husky-gold);
    }
  </style>
</head>
<body>

  <!-- UW grid and watermark -->
  <div class="uw-grid-layer" aria-hidden="true"></div>
  <div class="w-watermark" aria-hidden="true">W</div>

  <!-- Blob filter definition -->
  <svg width="0" height="0" style="position:absolute">
    <filter id="husky-blob">
      <feGaussianBlur in="SourceGraphic" stdDeviation="22" result="blur" />
      <feColorMatrix
        in="blur"
        mode="matrix"
        values="1 0 0 0 0
                0 1 0 0 0
                0 0 1 0 0
                0 0 0 35 -10"
      />
    </filter>
  </svg>

  <!-- Blob cursor layer -->
  <div class="blob-layer">
    <div class="blob-dot"></div>
    <div class="blob-dot"></div>
    <div class="blob-dot"></div>
    <div class="blob-dot"></div>
    <div class="blob-dot"></div>
    <div class="blob-dot"></div>
  </div>

  <!-- Traffic layer -->
  <div class="traffic-layer" aria-hidden="true"></div>

  <!-- Confetti layer -->
  <div id="confetti-layer" aria-hidden="true"></div>

  <!-- Toast -->
  <div id="dawgsToast" class="toast" role="status" aria-live="polite">
    <span class="toast-dot"></span>
    <span id="toastText">Go Dawgs!</span>
  </div>

  <!-- Main UI -->
  <div class="app-shell">
    <div class="hero">
      <div class="title" id="titleChip" title="Double click for a tiny secret.">
        <span class="title-pill-dot"></span>
        <span>SurgeTester</span>
        <span class="title-ta-tag">Project 2</span>
      </div>
      <h1><span class="grad">TCSS 142</span> Project 2 Tester</h1>
      <p>Paste <b>SurgeSimulator.java</b> to run automated correctness and boundary tests.</p>
      <p class="credit" id="heroMood">
        Instructor: Professor Xutong Liu ¬∑ Built and maintained by TA Faiz Ahmed
      </p>
    </div>

    <main class="wrap">
      <section class="card">
        <div class="section-head">
          <b>Editor</b>
          <div class="tools">
            <button class="tbtn" id="exampleBtn">
              <span>üìã</span><span>Insert template</span>
            </button>
          </div>
        </div>

        <div class="codebox">
          <div class="gutter" id="gutter">1</div>
          <textarea id="code" spellcheck="false" placeholder="Paste your SurgeSimulator.java here..."></textarea>
        </div>

        <div class="bar">
          <button class="btn" id="runBtn">
            <span>‚ñ∂</span><span>Run Tests</span>
          </button>
          <button class="btn secondary" id="clearBtn">Clear</button>

          <span class="chip">
            <i class="dot" id="dot"></i>
            <span id="statusText">Idle</span>
          </span>

          <div class="meter" id="meter"><div class="fill"></div></div>

          <span class="meta" id="confidenceMeta"></span>
          <span class="meta" id="cheerMeta"></span>
          <span class="meta" id="lenMeta"></span>
        </div>
      </section>

      <section class="card console">
        <div class="section-head" style="padding:0 0 10px 0;">
          <b>Output</b><span class="meta">Shows the last run</span>
        </div>
        <div class="screen" id="out">Waiting for input‚Ä¶</div>
      </section>
    </main>

    <footer>
      <div class="foot-card">
        <div>
          <div style="margin-bottom:6px;">
            This tester is an unofficial helper tool designed and coded by TA <b>Faiz Ahmed</b> for TCSS 142.
          </div>
          <div>
            Need help? Contact <b>Faiz Ahmed</b> (<a href="mailto:faizahm@uw.edu">faizahm@uw.edu</a>)
          </div>
          <div class="shortcuts">
            <div><span class="kbd">Ctrl</span>/<span class="kbd">Cmd</span> + <span class="kbd">Enter</span> - run tests</div>
            <div><span class="kbd">Esc</span> - clear code and output ‚Ä¢ <span class="kbd">Shift</span> + <span class="kbd">Esc</span> - clear output only</div>
            <div><span class="kbd">Ctrl</span>/<span class="kbd">Cmd</span> + <span class="kbd">I</span> - insert template ‚Ä¢ <span class="kbd">Ctrl</span>/<span class="kbd">Cmd</span> + <span class="kbd">L</span> - clear</div>
            <div><span class="kbd">Ctrl</span>/<span class="kbd">Cmd</span> + <span class="kbd">S</span> - save to browser ‚Ä¢ <span class="kbd">Ctrl</span>/<span class="kbd">Cmd</span> + <span class="kbd">O</span> - load</div>
          </div>
        </div>
        <div id="footHint">If tests hang, check for infinite loops or very heavy printing.</div>
      </div>
    </footer>
  </div>

  <script>
    /* ---------------- Tester JS ---------------- */

    const codeEl   = document.getElementById("code");
    const gutter   = document.getElementById("gutter");
    const runBtn   = document.getElementById("runBtn");
    const clearBtn = document.getElementById("clearBtn");
    const out      = document.getElementById("out");
    const statusTx = document.getElementById("statusText");
    const dot      = document.getElementById("dot");
    const lenMeta  = document.getElementById("lenMeta");
    const example  = document.getElementById("exampleBtn");
    const meter    = document.getElementById("meter");
    const confidenceMeta = document.getElementById("confidenceMeta");
    const cheerMeta = document.getElementById("cheerMeta");
    const fillEl   = document.querySelector(".meter .fill");
    const titleChip = document.getElementById("titleChip");
    const heroMood  = document.getElementById("heroMood");
    const toastEl   = document.getElementById("dawgsToast");
    const toastText = document.getElementById("toastText");
    const footHint  = document.getElementById("footHint");

    const LS_KEY   = "tcss142_p2_surgesim_code";

    const cheerMessagesGood = [
      "Looks like surge logic is in great shape.",
      "Auto tester is happy. So is your future grade.",
      "Nice. Try a few weird edge cases too.",
      "All green lights for this ride."
    ];
    const cheerMessagesOkay = [
      "Closer than you think. Read the diffs carefully.",
      "Fix a few details and this will be solid.",
      "Edge cases are where the points hide.",
      "Look for off by one or rounding issues."
    ];
    const cheerMessagesError = [
      "Start with the first error at the top.",
      "Check your class name and file name first.",
      "Tiny syntax bugs often cause big wall of red.",
      "Try compiling locally before running here."
    ];

    function randomFrom(arr){
      return arr[Math.floor(Math.random()*arr.length)];
    }

    function setDocTitle(mode){
      if(mode === "running") document.title = "‚è≥ Running tests ¬∑ TCSS 142";
      else if(mode === "ok") document.title = "‚úÖ All checks passed ¬∑ TCSS 142";
      else if(mode === "err") document.title = "‚ö†Ô∏è Check your code ¬∑ TCSS 142";
      else document.title = "TCSS 142 ¬∑ Project 2 Tester";
    }

    function setStatus(kind, text){
      statusTx.textContent = text;
      dot.className = "dot " + (kind || "");
      if(kind === "ok") setDocTitle("ok");
      else if(kind === "err") setDocTitle("err");
      else if(kind === "warn" && text === "Running") setDocTitle("running");
      else setDocTitle("idle");
    }

    function setConfidence(pct, label){
      if(!fillEl || !confidenceMeta) return;
      fillEl.style.width = pct + "%";
      confidenceMeta.textContent = label ? "Confidence: " + label : "";
    }

    function updateGutter(){
      const lines = (codeEl.value.match(/\n/g)||[]).length + 1;
      let s = "";
      for(let i=1;i<=lines;i++) s += i + "\n";
      gutter.textContent = s;
      gutter.scrollTop = codeEl.scrollTop;
    }
    function updateLen(){
      const bytes = new TextEncoder().encode(codeEl.value).length;
      lenMeta.textContent = bytes ? "Size: " + bytes.toLocaleString() + " bytes" : "";
    }
    function setRunning(on){
      if(on) meter.classList.add("running");
      else   meter.classList.remove("running");
    }

    function showToast(msg){
      if(!toastEl) return;
      toastText.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(window._toastTimer);
      window._toastTimer = setTimeout(()=>{
        toastEl.classList.remove("show");
      }, 2600);
    }

    function clearAll(){
      if(codeEl.value.trim()){
        const ok = confirm("Clear editor and output?");
        if(!ok) return;
      }
      codeEl.value = "";
      updateGutter();
      updateLen();
      out.textContent = "Waiting for input‚Ä¶";
      setStatus("", "Idle");
      cheerMeta.textContent = "";
      setConfidence(0, "");
      setRunning(false);
      saveToLS();
    }
    function clearOutputOnly(){
      out.textContent = "Waiting for input‚Ä¶";
      setStatus("", "Idle");
      cheerMeta.textContent = "";
      setConfidence(0, "");
      setRunning(false);
    }
    function insertTemplate(){
      const tpl = `public class SurgeSimulator {
    // Add your fields, constants, and methods here.
}`;
      if(codeEl.value.trim() && !confirm("Replace existing code with a template?")) return;
      codeEl.value = tpl;
      updateGutter();
      updateLen();
      saveToLS();
      setStatus("ok","Template inserted");
      cheerMeta.textContent = "Fill in methods to match the project handout.";
    }

    function burstConfetti(){
      const layer = document.getElementById("confetti-layer");
      if(!layer) return;
      for(let i = 0; i < 45; i++){
        const piece = document.createElement("div");
        piece.style.position = "absolute";
        piece.style.width = "6px";
        piece.style.height = "14px";
        piece.style.borderRadius = "3px";
        const colors = ["#e8e3d3","#b7a57a","#4b2e83","#c5b4e3"];
        piece.style.background = colors[i % colors.length];
        piece.style.left = Math.random() * 100 + "vw";
        piece.style.top = "-24px";
        piece.style.opacity = "0.95";
        const duration = 1200 + Math.random() * 800;
        const translateX = (Math.random() * 2 - 1) * 80;
        piece.animate([
          { transform:"translate3d(0,0,0) rotate(0deg)", opacity:1 },
          { transform:"translate3d("+translateX+"px,100vh,0) rotate("+(360+Math.random()*360)+"deg)", opacity:0 }
        ], { duration, easing:"cubic-bezier(.17,.67,.34,1.01)" });
        setTimeout(() => piece.remove(), duration + 80);
        layer.appendChild(piece);
      }
    }

    async function runTests(){
      const code = codeEl.value.trim();
      if(!code){
        setStatus("warn","No code");
        setConfidence(0, "n/a");
        cheerMeta.textContent = "Paste your SurgeSimulator.java first.";
        out.textContent = "Paste your SurgeSimulator.java first.";
        return;
      }
      setStatus("warn","Running");
      setConfidence(45, "estimating");
      setRunning(true);
      cheerMeta.textContent = "";
      out.textContent = "Compiling and running‚Ä¶";
      saveToLS();

      const hour = new Date().getHours();
      if(hour >= 23 || hour < 6){
        heroMood.textContent = "Late night surge testing squad online. Tool by TA Faiz Ahmed.";
      } else {
        heroMood.textContent = "Instructor: Professor Xutong Liu ¬∑ Built and maintained by TA Faiz Ahmed";
      }

      try{
        const res  = await fetch("/run", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({ code })
        });
        const text = await res.text();
        out.textContent = text;

        if (text.includes("All checks passed")) {
          setStatus("ok","All checks passed (nice work).");
          setConfidence(100, "high");
          cheerMeta.textContent = randomFrom(cheerMessagesGood);
          burstConfetti();
          showToast("All checks passed. Go Dawgs, and props to your TA.");
        } else if (text.includes("Compilation failed")) {
          setStatus("err","Compilation failed");
          setConfidence(20, "low");
          cheerMeta.textContent = randomFrom(cheerMessagesError);
          showToast("Check your syntax and class name.");
        } else if (text.toLowerCase().includes("timed out")) {
          setStatus("warn","Timed out");
          setConfidence(50, "uncertain");
          cheerMeta.textContent = "If it hangs, look for infinite loops or input waiting.";
          showToast("Tester hit a timeout.");
        } else {
          setStatus("warn","Completed");
          setConfidence(65, "medium");
          cheerMeta.textContent = randomFrom(cheerMessagesOkay);
        }
      }catch{
        out.textContent = "Network error.";
        setStatus("err","Network error");
        setConfidence(0, "n/a");
        cheerMeta.textContent = "Check your connection or try again in a bit.";
        showToast("Could not reach the tester.");
      }finally{
        setRunning(false);
      }
    }

    function saveToLS(){ try{ localStorage.setItem(LS_KEY, codeEl.value) }catch{} }
    function loadFromLS(){
      try{
        const v = localStorage.getItem(LS_KEY);
        if(v != null){
          codeEl.value = v;
          updateGutter();
          updateLen();
        }
      }catch{}
    }

    codeEl.addEventListener("input",()=>{
      updateGutter();
      updateLen();
      saveToLS();
    });
    codeEl.addEventListener("scroll",()=>{
      gutter.scrollTop = codeEl.scrollTop;
    });
    clearBtn.addEventListener("click",clearAll);
    example.addEventListener("click",insertTemplate);
    runBtn.addEventListener("click",runTests);

    // Keyboard shortcuts (Windows or Linux Ctrl, macOS Cmd)
    window.addEventListener("keydown", (e)=>{
      const mod = e.ctrlKey || e.metaKey;

      if(mod && e.key === "Enter"){
        e.preventDefault();
        runTests();
        return;
      }
      if(e.key === "Escape" && !e.shiftKey){
        e.preventDefault();
        clearAll();
        return;
      }
      if(mod && (e.key.toLowerCase() === "l")){
        e.preventDefault();
        clearAll();
        return;
      }
      if(e.key === "Escape" && e.shiftKey){
        e.preventDefault();
        clearOutputOnly();
        return;
      }
      if(mod && (e.key.toLowerCase() === "i")){
        e.preventDefault();
        insertTemplate();
        return;
      }
      if(mod && (e.key.toLowerCase() === "s")){
        e.preventDefault();
        saveToLS();
        setStatus("ok","Saved");
        return;
      }
      if(mod && (e.key.toLowerCase() === "o")){
        e.preventDefault();
        loadFromLS();
        setStatus("ok","Loaded");
        return;
      }
    });

    loadFromLS();
    updateGutter();
    updateLen();
    setRunning(false);
    setConfidence(0, "");

    /* ---------------- Husky Purple Blob Cursor JS ---------------- */

    (function(){
      const dots = Array.from(document.querySelectorAll(".blob-dot"));
      if (!dots.length) return;

      const nodes = dots.map(() => ({
        x: window.innerWidth / 2,
        y: window.innerHeight / 2
      }));

      let targetX = window.innerWidth / 2;
      let targetY = window.innerHeight / 2;

      const speeds = [0.22, 0.18, 0.16, 0.14, 0.12, 0.10];

      function animateBlob(){
        nodes[0].x += (targetX - nodes[0].x) * speeds[0];
        nodes[0].y += (targetY - nodes[0].y) * speeds[0];

        for(let i = 1; i < nodes.length; i++){
          nodes[i].x += (nodes[i-1].x - nodes[i].x) * speeds[i];
          nodes[i].y += (nodes[i-1].y - nodes[i].y) * speeds[i];
        }

        nodes.forEach((node, i) => {
          dots[i].style.transform =
            "translate3d(" + node.x + "px," + node.y + "px,0) translate3d(-50%,-50%,0)";
        });

        requestAnimationFrame(animateBlob);
      }

      window.addEventListener("pointermove", (e)=>{
        targetX = e.clientX;
        targetY = e.clientY;
      });

      window.addEventListener("touchmove", (e)=>{
        const t = e.touches[0];
        if(!t) return;
        targetX = t.clientX;
        targetY = t.clientY;
      }, { passive:true });

      window.addEventListener("resize", ()=>{
        if (!nodes.length) return;
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        targetX = cx;
        targetY = cy;
        nodes.forEach(n => { n.x = cx; n.y = cy; });
      });

      animateBlob();
    })();

    /* ---------------- Background traffic JS ---------------- */

    (function spawnTraffic(){
      const layer = document.querySelector(".traffic-layer");
      if (!layer) return;
      const lanes = [22, 38, 56, 74];
      const emojis = ["üöó","üöï","üöô","üöê"];
      for (let i = 0; i < lanes.length; i++) {
        const car = document.createElement("div");
        car.className = "traffic-car";
        car.textContent = emojis[i % emojis.length];
        car.style.top = lanes[i] + "vh";
        car.style.animationDelay = (-Math.random()*16) + "s";
        car.style.opacity = 0.6 + Math.random()*0.2;
        layer.appendChild(car);
      }
    })();

    /* ---------------- Tiny easter eggs ---------------- */

    // Double click on SurgeTester chip
    titleChip.addEventListener("dblclick", ()=>{
      showToast("TA dev credits unlocked. This tester was coded by Faiz Ahmed.");
      footHint.textContent = "You got this!";
    });

    // Little hint switch on hover of meter
    meter.addEventListener("mouseenter", ()=>{
      meter.title = "Rough confidence gauge, not an official score.";
    });
  </script>
</body>
</html>
